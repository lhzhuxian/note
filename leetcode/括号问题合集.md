## 921 Minimum Add to Make Parentheses Valid

Given a string `s` of `'('` and `')'` parentheses, we add the minimum number of parentheses ( `'('` or `')'`, and in any positions ) so that the resulting parentheses string is valid.

Formally, a parentheses string is valid if and only if:

- It is the empty string, or
- It can be written as `AB` (`A` concatenated with `B`), where `A` and `B` are valid strings, or
- It can be written as `(A)`, where `A` is a valid string.

Given a parentheses string, return the minimum number of parentheses we must add to make the resulting string valid.

**Example 1:**

```
Input: s = "())"
Output: 1
```

**Example 2:**

```
Input: s = "((("
Output: 3
```

**Example 3:**

```
Input: s = "()"
Output: 0
```

**Example 4:**

```
Input: s = "()))(("
Output: 4
```

**Solution**

we use a counter to count the number `(` we see. If we see ')' and the count is larger than 0, they can match and we delete 1. If count is equal to 0, we know that we need to add a `(`. Add the remaining count to the result.

```java
class Solution {
    public int minAddToMakeValid(String s) {
        int result = 0;
        int count = 0;
        for(int i = 0; i < s.length(); ++i) {
            if(s.charAt(i) == '(') {
                count++;
            } else if (count > 0) {
                count--;
            } else {
                result++;
            }
        }
        return result + count;
    }
}
```



------



## 1249 Minimum Remove to Make Valid Parentheses

Given a string s of `'('` , `')'` and lowercase English characters. 

Your task is to remove the minimum number of parentheses ( `'('` or `')'`, in any positions ) so that the resulting *parentheses string* is valid and return **any** valid string.

Formally, a *parentheses string* is valid if and only if:

- It is the empty string, contains only lowercase characters, or
- It can be written as `AB` (`A` concatenated with `B`), where `A` and `B` are valid strings, or
- It can be written as `(A)`, where `A` is a valid string.

 

**Example 1:**

```
Input: s = "lee(t(c)o)de)"
Output: "lee(t(c)o)de"
Explanation: "lee(t(co)de)" , "lee(t(c)ode)" would also be accepted.
```

**Example 2:**

```
Input: s = "a)b(c)d"
Output: "ab(c)d"
```

**Example 3:**

```
Input: s = "))(("
Output: ""
Explanation: An empty string is also valid.
```

**Example 4:**

```
Input: s = "(a(b(c)d)"
Output: "a(b(c)d)"
```

**Solution**

这道题因为需要track 删除括号的index，所以需要一个stack，要不然用一个count来记就行了

```java
class Solution {
    public String minRemoveToMakeValid(String s) {
      // record the char index that we want to remove 
        Set<Integer> indexesToRemove = new HashSet<>();
        Deque<Integer> stack = new ArrayDeque<>();
        // 并不用把)也push进去，这样就不用pair来记录了 
        for (int i = 0; i < s.length(); i++) {
            if (s.charAt(i) == '(') {
                stack.push(i);
            } if (s.charAt(i) == ')') {
                if (stack.isEmpty()) {
                    indexesToRemove.add(i);
                } else {
                    stack.pop();
                }
            }
        }
        // Put any indexes remaining on stack into the set.
        while (!stack.isEmpty()) indexesToRemove.add(stack.pop());
        StringBuilder sb = new StringBuilder();
        for (int i = 0; i < s.length(); i++) {
            if (!indexesToRemove.contains(i)) {
                sb.append(s.charAt(i));
            }
        }
        return sb.toString();
    }
}
```



## 301 Remove Invalid Parentheses

Given a string `s` that contains parentheses and letters, remove the minimum number of invalid parentheses to make the input string valid.

Return *all the possible results*. You may return the answer in **any order**. 

**Example 1:**

```
Input: s = "()())()"
Output: ["(())()","()()()"]
```

**Example 2:**

```
Input: s = "(a)())()"
Output: ["(a())()","(a)()()"]
```

**Example 3:**

```
Input: s = ")("
Output: [""]
```

**Solution**

上面这题的升级版，要你return 所有的result

几个关键点 

1. 如何处理duplicate 

   duplicate 会在下面这种情况发生 ((()))) 右边四个）删除任意一个都可以，我们只选择第一个

2. 会有两种情况，第一种是右括号多，要删除右括号，另外是左括号多，要删除左括号，其实原理是一种的，所以我们可以reuse code， 左括号多的时候就把string reverse 过来做一遍

```java
class Solution {
    public List<String> removeInvalidParentheses(String s) {
        List<String> res = new ArrayList<>();
        helper(s, 0, 0, res, new char[]{'(', ')'});
        return res;
    }
    
    private void helper (String s, int left, int right, List<String> res, char[] pars) {
        int stack = 0;
        int n = s.length();
        for(; right < n; right++) {
            char c = s.charAt(right);
            if(c == pars[0]) {
                stack++;
            } else if(c == pars[1]) {
                stack--;
            }
            if(stack < 0) break;
        }
        // 有多余的 ) 括号要删除
        if(stack < 0) {
            for(;left <= right; left++) {
                char c = s.charAt(left);
                if(c != pars[1]) continue;
                if(left - 1 >= 0 && s.charAt(left) == s.charAt(left - 1)) continue;
                helper(s.substring(0, left) + s.substring(left + 1), left, right, res, pars);
            }
            // 有多余的（括号要删除，那就把全部反过来做
        } else if(stack > 0) {
            helper(new StringBuilder(s).reverse().toString(), 0, 0,res, new char[]{')', '('});
        } else {
            res.add(pars[0] == '(' ? s : new StringBuilder(s).reverse().toString());
        }
    }
}
```

